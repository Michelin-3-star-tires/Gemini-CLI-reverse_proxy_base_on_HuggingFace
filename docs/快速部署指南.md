# geminicli2api å¿«é€Ÿéƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨10åˆ†é’Ÿå†…å®Œæˆ geminicli2api çš„æœ¬åœ°éƒ¨ç½²ã€‚

## ğŸ“‹ å‰ç½®æ£€æŸ¥

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹æ¡ä»¶ï¼š

- [ ] å·²å®‰è£… Docker Desktopï¼ˆWindows/Macï¼‰æˆ– Docker Engineï¼ˆLinuxï¼‰
- [ ] Docker æ­£åœ¨è¿è¡Œä¸­
- [ ] å·²è·å– Google OAuth å‡­è¯ï¼ˆå¦‚æœªè·å–ï¼Œå‚è€ƒ `Google_OAuthå‡­è¯è·å–æ•™ç¨‹.md`ï¼‰
- [ ] 8888ç«¯å£æœªè¢«å ç”¨

éªŒè¯Dockerï¼š
```bash
docker --version
docker-compose --version
```

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ3æ­¥ï¼‰

### æ­¥éª¤1ï¼šé…ç½®ç¯å¢ƒå˜é‡

1. **å¤åˆ¶ç¤ºä¾‹é…ç½®**
   ```bash
   cd 202510201435_æµ‹è¯•geminicliåå‘ä»£ç†
   copy .env.example .env
   ```

2. **ç¼–è¾‘ .env æ–‡ä»¶**
   
   ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ `.env`ï¼Œå¡«å…¥ä»¥ä¸‹ä¿¡æ¯ï¼š

   ```env
   # APIè®¿é—®å¯†ç ï¼ˆè‡ªå·±è®¾ç½®ä¸€ä¸ªå¼ºå¯†ç ï¼‰
   GEMINI_AUTH_PASSWORD=your_strong_password_123
   
   # æœåŠ¡ç«¯å£
   PORT=8888
   
   # Google OAuthå‡­è¯ï¼ˆJSONå­—ç¬¦ä¸²ï¼‰
   GEMINI_CREDENTIALS='{"client_id":"your-client-id","client_secret":"your-client-secret","token":"your-access-token","refresh_token":"your-refresh-token","scopes":["https://www.googleapis.com/auth/cloud-platform"],"token_uri":"https://oauth2.googleapis.com/token","project_id":"your-project-id"}'
   ```

   **é‡è¦**ï¼š
   - å°†ä¸Šé¢çš„ `your_strong_password_123` æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„å¯†ç 
   - å°† `GEMINI_CREDENTIALS` çš„å€¼æ›¿æ¢ä¸ºæ‚¨çš„å®Œæ•´OAuthå‡­è¯JSON
   - ç¡®ä¿JSONå­—ç¬¦ä¸²ç”¨å•å¼•å·åŒ…è£¹

### æ­¥éª¤2ï¼šå¯åŠ¨æœåŠ¡

```bash
docker-compose up -d
```

ç­‰å¾…çº¦30ç§’ï¼ŒDockerä¼šè‡ªåŠ¨ï¼š
- æ„å»ºé•œåƒ
- åˆ›å»ºå®¹å™¨
- å¯åŠ¨æœåŠ¡

### æ­¥éª¤3ï¼šéªŒè¯éƒ¨ç½²

```bash
curl http://localhost:8888/health
```

**é¢„æœŸå“åº”**ï¼š
```json
{"status":"healthy","service":"geminicli2api"}
```

å¦‚æœçœ‹åˆ°è¿™ä¸ªå“åº”ï¼Œæ­å–œï¼éƒ¨ç½²æˆåŠŸï¼ğŸ‰

---

## ğŸ§ª å¿«é€Ÿæµ‹è¯•

### æµ‹è¯•1ï¼šåˆ—å‡ºå¯ç”¨æ¨¡å‹

```bash
curl -X GET http://localhost:8888/v1/models ^
  -H "Authorization: Bearer your_strong_password_123"
```

åº”è¯¥çœ‹åˆ°ä¸€é•¿ä¸²æ¨¡å‹åˆ—è¡¨ã€‚

### æµ‹è¯•2ï¼šç®€å•å¯¹è¯

```bash
curl -X POST http://localhost:8888/v1/chat/completions ^
  -H "Authorization: Bearer your_strong_password_123" ^
  -H "Content-Type: application/json" ^
  -d "{\"model\":\"gemini-2.5-flash\",\"messages\":[{\"role\":\"user\",\"content\":\"ä½ å¥½\"}]}"
```

åº”è¯¥æ”¶åˆ°Geminiçš„å›å¤ã€‚

### æµ‹è¯•3ï¼šä½¿ç”¨Pythonï¼ˆæ¨èï¼‰

åˆ›å»ºæµ‹è¯•æ–‡ä»¶ `test_quick.py`ï¼š

```python
import openai

client = openai.OpenAI(
    base_url="http://localhost:8888/v1",
    api_key="your_strong_password_123"  # æ›¿æ¢ä¸ºä½ çš„å¯†ç 
)

response = client.chat.completions.create(
    model="gemini-2.5-flash",
    messages=[
        {"role": "user", "content": "ç”¨ä¸€å¥è¯ä»‹ç»äººå·¥æ™ºèƒ½"}
    ]
)

print(response.choices[0].message.content)
```

è¿è¡Œï¼š
```bash
python test_quick.py
```

---

## ğŸ“Š è¿ç»´å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
docker-compose ps
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker-compose logs

# å®æ—¶è·Ÿè¸ªæ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹æœ€è¿‘100è¡Œ
docker-compose logs --tail=100
```

### åœæ­¢æœåŠ¡
```bash
docker-compose stop
```

### é‡å¯æœåŠ¡
```bash
docker-compose restart
```

### å®Œå…¨åœæ­¢å¹¶åˆ é™¤å®¹å™¨
```bash
docker-compose down
```

### é‡æ–°æ„å»ºå¹¶å¯åŠ¨
```bash
docker-compose up -d --build
```

---

## ğŸ”§ å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

### Q1: ç«¯å£è¢«å ç”¨

**ç°è±¡**ï¼š
```
Error: bind: address already in use
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

æ–¹æ³•1ï¼šä¿®æ”¹ç«¯å£
```bash
# ç¼–è¾‘ .env æ–‡ä»¶
PORT=8889  # æ”¹ä¸ºå…¶ä»–ç«¯å£
```

æ–¹æ³•2ï¼šæŸ¥æ‰¾å¹¶å…³é—­å ç”¨è¿›ç¨‹
```bash
# Windows
netstat -ano | findstr :8888
taskkill /PID <è¿›ç¨‹ID> /F

# Linux/Mac
lsof -ti:8888 | xargs kill -9
```

### Q2: Dockeræœªå¯åŠ¨

**ç°è±¡**ï¼š
```
Cannot connect to the Docker daemon
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¯åŠ¨ Docker Desktop
- ç­‰å¾…Dockerå®Œå…¨å¯åŠ¨ï¼ˆæ‰˜ç›˜å›¾æ ‡æ­£å¸¸ï¼‰
- é‡è¯•éƒ¨ç½²å‘½ä»¤

### Q3: å‡­è¯æ— æ•ˆ

**ç°è±¡**ï¼š
```
Authentication failed
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„å‡­è¯æ ¼å¼
2. ç¡®ä¿JSONæ ¼å¼æ­£ç¡®ï¼ˆä½¿ç”¨åœ¨çº¿JSONéªŒè¯å™¨ï¼‰
3. é‡æ–°è·å–OAuthå‡­è¯
4. æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼š`docker-compose logs`

### Q4: æ— æ³•è®¿é—®API

**ç°è±¡**ï¼š
```
Connection refused
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤æœåŠ¡æ­£åœ¨è¿è¡Œï¼š`docker-compose ps`
2. æ£€æŸ¥å¥åº·ç«¯ç‚¹ï¼š`curl http://localhost:8888/health`
3. æŸ¥çœ‹æ—¥å¿—æ’æŸ¥é”™è¯¯ï¼š`docker-compose logs`

---

## ğŸ¯ ä¸‹ä¸€æ­¥

éƒ¨ç½²æˆåŠŸåï¼Œæ‚¨å¯ä»¥ï¼š

1. **è¿è¡Œå®Œæ•´æµ‹è¯•**
   ```bash
   cd src
   python test_openai_api.py
   python test_gemini_api.py
   ```

2. **é˜…è¯»è¯¦ç»†æ–‡æ¡£**
   - ğŸ“˜ [é¡¹ç›®è§„åˆ’](é¡¹ç›®è§„åˆ’.md) - å®Œæ•´æŠ€æœ¯åˆ†æ
   - ğŸ“˜ [OAuthæ•™ç¨‹](Google_OAuthå‡­è¯è·å–æ•™ç¨‹.md) - å‡­è¯ç®¡ç†
   - ğŸ“˜ [æ•…éšœæ’æŸ¥](æ•…éšœæ’æŸ¥æŒ‡å—.md) - é—®é¢˜è§£å†³

3. **é›†æˆåˆ°æ‚¨çš„é¡¹ç›®**
   - å°† `base_url` è®¾ç½®ä¸º `http://localhost:8888/v1`
   - ä½¿ç”¨æ‚¨çš„å¯†ç ä½œä¸º `api_key`
   - ä½¿ç”¨ä»»ä½•æ”¯æŒOpenAI APIçš„å®¢æˆ·ç«¯åº“

---

## ğŸ’¡ æœ€ä½³å®è·µ

### å®‰å…¨å»ºè®®
- âœ… ä½¿ç”¨å¼ºå¯†ç ï¼ˆè‡³å°‘16ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
- âœ… å®šæœŸè½®æ¢OAuthå‡­è¯
- âœ… ä¸è¦åœ¨å…¬å¼€åœºåˆåˆ†äº« `.env` æ–‡ä»¶
- âœ… ç”Ÿäº§ç¯å¢ƒä½¿ç”¨HTTPS

### æ€§èƒ½ä¼˜åŒ–
- âœ… ä½¿ç”¨ `gemini-2.5-flash` è·å¾—æ›´å¿«å“åº”
- âœ… å¯ç”¨æµå¼è¾“å‡ºå‡å°‘ç­‰å¾…æ—¶é—´
- âœ… åˆç†è®¾ç½® `max_tokens` å‚æ•°
- âœ… ä½¿ç”¨è¿æ¥æ± å¤ç”¨TCPè¿æ¥

### ç›‘æ§å»ºè®®
- âœ… å®šæœŸæ£€æŸ¥æœåŠ¡å¥åº·ï¼š`curl http://localhost:8888/health`
- âœ… ç›‘æ§æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œå®šæœŸæ¸…ç†
- âœ… è®¾ç½®èµ„æºé™åˆ¶ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°æœ¬æŒ‡å—æœªæ¶µç›–çš„é—®é¢˜ï¼š

1. æŸ¥çœ‹ [æ•…éšœæ’æŸ¥æŒ‡å—](æ•…éšœæ’æŸ¥æŒ‡å—.md)
2. æŸ¥çœ‹é¡¹ç›®æ—¥å¿—ï¼š`docker-compose logs`
3. è®¿é—®åŸé¡¹ç›® Issuesï¼šhttps://github.com/gzzhongqi/geminicli2api/issues
4. å‚è€ƒæœ¬åœ°çš„ [é¡¹ç›®è§„åˆ’.md](é¡¹ç›®è§„åˆ’.md) æ–‡æ¡£

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¶é—´**: 2025-10-20  
**é¢„è®¡éƒ¨ç½²æ—¶é—´**: 10åˆ†é’Ÿ

ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼ğŸš€

